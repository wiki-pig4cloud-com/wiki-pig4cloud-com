---
title: "Token æ ¡éªŒé‰´æƒæµç¨‹ ğŸ‘"
---

<Note>
**Token è®¤è¯æµç¨‹æ¦‚è¿°**

å½“ç”¨æˆ·æºå¸¦ token è¯·æ±‚èµ„æºæœåŠ¡å™¨çš„èµ„æºæ—¶ï¼ŒSpring Security æ‹¦æˆª tokenï¼Œè¿›è¡Œ token å’Œ userdetails åŒ¹é…è¿‡ç¨‹ï¼ŒæŠŠæ— çŠ¶æ€çš„ token è½¬åŒ–æˆå…·ä½“ç”¨æˆ·ã€‚
</Note>

![Token æ ¡éªŒæµç¨‹](/images/1656242926639-8ef6bdcf-3ef9-4557-8e85-ebd79ed79b8e.png)

## 1. Filter æ‹¦æˆªè¯·æ±‚è¿›è¡Œé‰´æƒ

<Info>
**BearerTokenAuthenticationFilter åŠŸèƒ½è¯´æ˜**

- æ‹¦æˆªæ‰€æœ‰èµ„æºæœåŠ¡å™¨çš„è¯·æ±‚
- è§£æ header æˆ–è€…å‚æ•°ä¸­çš„ access_token å­—æ®µ
- æ ¹æ® access_token æ„é€ å‡ºæ¥ BearerTokenAuthenticationToken è®¤è¯å¯¹è±¡
</Info>

![Filter æ‹¦æˆªæµç¨‹](/images/1656243169406-f63b7d54-2f6a-450f-a3e3-54378eba9fc9.png)

## 2. åŒ¹é…è‡ªçœé‰´æƒå¤„ç†å™¨

![è‡ªçœé‰´æƒå¤„ç†å™¨](/images/1656243415234-41e6db77-2bc6-474d-a082-ba15cf89abae.png)

## 3. è°ƒç”¨è‡ªçœæ‹¦æˆªå™¨å®ç°å¤„ç†

<Info>
**è‡ªçœæ‹¦æˆªå™¨å¤„ç†æµç¨‹**

- PigRedisOAuth2AuthorizationService é€šè¿‡ token value æŸ¥è¯¢è®¤è¯ä¸­å¿ƒä¸‹å‘ä»¤ç‰Œæ—¶å­˜å‚¨çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯
- æ ¹æ®ç”¨æˆ·è®¤è¯ä¿¡æ¯å†æ¬¡è°ƒç”¨ PigUserDetailsService æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æœ€æ–°æ•°æ®
- é¿å… redis å­˜å‚¨æ—§æ•°æ®ï¼Œå®ç°æƒé™å®æ—¶æ›´æ–°
</Info>

![è‡ªçœæ‹¦æˆªå™¨å®ç°](/images/1656243603568-b19f6bfc-629b-4076-ad20-b4c789e57a19.png)

## 4. æ¥å£è¿›è¡Œæƒé™åˆ¤æ–­

<Info>
**æƒé™åˆ¤æ–­æœºåˆ¶**

å¦‚ä¸‹ä»£ç ä¸Šè¿›è¡Œ hasPermission é‰´æƒæ“ä½œä¼šè°ƒç”¨ **PermissionService.hasPermission** è¿›è¡Œæƒé™åˆ¤æ–­
</Info>

```java
@GetMapping("/export")
@PreAuthorize("@pms.hasPermission('sys_user_import_export')")
public List<UserExcelVO> export(UserDTO userDTO) {
}
```

![æƒé™åˆ¤æ–­ç¤ºä¾‹](/images/1656243795.png)

## 5. PIG æ•°æ®åº“æƒé™æ¨¡å‹

<Info>
**æƒé™æ¨¡å‹è¯´æ˜**

- **ç”¨æˆ· 1 : è§’è‰² N** (ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²)
- **è§’è‰² 1 : èœå• (æƒé™) N** (ä¸€ä¸ªè§’è‰²å¯ä»¥æ‹¥æœ‰å¤šä¸ªæƒé™)
</Info>

![æ•°æ®åº“æƒé™æ¨¡å‹](/images/1656244704693-cb1b39b5-64d3-48be-a1be-f9baa0653b55.png)

## â™¥ï¸ è·å–æ”¯æŒ
<Card title="é‡åˆ°é—®é¢˜ï¼Ÿ" horizontal icon="link" href="https://gitee.com/log4j/pig/issues">
  å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ã€æœ‰åŠŸèƒ½å»ºè®®æˆ–éœ€æ±‚ï¼Œè¯·ç‚¹å‡»æ­¤å¡ç‰‡å‰å¾€ Gitee ä»“åº“æäº¤ Issueã€‚
</Card>
