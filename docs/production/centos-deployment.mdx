---
title: "æœ€åçš„å‚æ•°ä¸ºä¸»æœºå"
---



## åŸºç¡€ç¯å¢ƒæ­å»º
### â‘  è´­ä¹° ECS


 ç‰¹åˆ«è¯´æ˜ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå¼ºçƒˆå»ºè®®é€‰æ‹©ã€ECS æŒ‰é‡ä»˜è´¹ã€‘[ğŸ‘‰ğŸ» ã€Šé˜¿é‡Œäº‘æœåŠ¡å™¨ ECS æŒ‰é‡ä»˜è´¹å’ŒåŒ…å¹´åŒ…æœˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿã€‹](https://developer.aliyun.com/article/1178762?source=5176.11533457&userCode=ueyxv2qf)



+ [ğŸ‘‰ğŸ» å»ºè®®ç›´æ¥è®¿é—®é˜¿é‡Œäº‘ ECS å®˜ç½‘è¿›è¡Œè´­ä¹°ï¼Œæ— éœ€å…³æ³¨å®˜æ–¹æ´»åŠ¨ï¼Œå› ä¸ºå®˜æ–¹æ´»åŠ¨å¹¶ä¸ä¸€å®šä¼šæ›´ä¾¿å®œã€‚ã€é€‰æ‹©æŒ‰é‡ä»˜è´¹ã€‘](https://www.aliyun.com/product/ecs?source=5176.11533457&userCode=ueyxv2qf)

| è‡ªå®šä¹‰è´­ä¹° | é…ç½® |
| --- | --- |
| ä»˜è´¹ç±»å‹ | æŒ‰é‡ä»˜è´¹ |
| å®ä¾‹ | 2vCPU/16GiB/Intel å¤„ç†å™¨ |
| é•œåƒ | CentOS 7.9 64 ä½ |
| ç³»ç»Ÿç›˜ | 100GB |
| å…¬ç½‘ IP | åˆ†é… |
| å¸¦å®½è®¡è´¹æ¨¡å¼ | æŒ‰ä½¿ç”¨æµé‡ |
| å¸¦å®½å³°å€¼ | 100Mbps |


### â‘¡ åˆå§‹åŒ– CentOS7


```shell
# æœ€åçš„å‚æ•°ä¸ºä¸»æœºå
curl http://vip.pigx.top/os7init.sh | sh -s -- pig4cloud
```



### â‘¢ å®‰è£… JDK


```shell
wget https://cdn.azul.com/zulu/bin/zulu17.44.15-ca-jdk17.0.8-linux.x86_64.rpm

rpm -ivh zulu17.44.15-ca-jdk17.0.8-linux.x86_64.rpm

java -version
```



### â‘£ å®‰è£… Mysql 8


```shell
wget http://vip.pigx.top/mysql80-community-release-el7-11.noarch.rpm -O mysql80-community-release-el7-7.noarch.rpm

rpm -ivh mysql80-community-release-el7-7.noarch.rpm

yum install -y mysql mysql-server

# ä¿®æ”¹é…ç½®æ–‡ä»¶
vim /etc/my.cnf
lower_case_table_names=1

# é‡å¯ mysql
systemctl restart mysqld

# æŸ¥çœ‹é»˜è®¤å¯†ç 
grep password /var/log/mysqld.log

# mysql client é“¾æ¥ mysql
mysql -uroot -p

alter user 'root'@'localhost' identified by 'ZxcRoot123!@#';
set global validate_password.check_user_name=0;
set global validate_password.policy=0;
set global validate_password.length=1;
alter user 'root'@'localhost' identified by 'root';

# ä¿®æ”¹ä¸ºå…è®¸è¿œç¨‹è®¿é—®
use mysql;
update user set host = '%' where user = 'root';
FLUSH PRIVILEGES;
```



### â‘¤ å®‰è£… Redis
```shell
yum install redis

systemctl restart redis
```



### â‘¥ å®‰è£… NGINX


```shell
vim /etc/yum.repos.d/nginx.repo

[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
```



```shell
yum install -y yum-utils
yum-config-manager --enable nginx-mainline
yum install -y nginx
```

### â‘¦ é…ç½® hosts


```shell
vim /etc/hosts

127.0.0.1   pig-mysql
127.0.0.1   pig-redis
127.0.0.1   pig-gateway
127.0.0.1   pig-register
127.0.0.1   pig-sentinel
127.0.0.1   pig-job

source /etc/hosts
```



## éƒ¨ç½²åº”ç”¨ä»£ç 


### å‡†å¤‡æºç åŒ…


+ pig æœåŠ¡ç«¯ ç¼–è¯‘ jar



```shell
mvn clean install
```



+ pig-ui å‰ç«¯ ç¼–è¯‘ dist



```shell
npm run build
```



### åˆå§‹åŒ–æ•°æ®åº“


```shell
mysql -uroot -proot

-- æ ¸å¿ƒæ•°æ®åº“
source db/pig.sql;
-- nacosé…ç½®
source db/pig_config.sql;
-- ä»£ç ç”Ÿæˆæ¨¡å—è„šæœ¬
source db/pig_codegen.sql;
-- å®šæ—¶ä»»åŠ¡æ¨¡å—è„šæœ¬
source db/pig_job.sql;
```



### å¯åŠ¨æœåŠ¡ç«¯


```shell
nohup java -Dfile.encoding=utf-8 -jar pig-register.jar > /dev/null 2>&1 &

nohup java -Dfile.encoding=utf-8 -jar pig-monitor.jar > /dev/null 2>&1 &
nohup java -Dfile.encoding=utf-8 -jar pig-gateway.jar > /dev/null 2>&1 &
nohup java -Dfile.encoding=utf-8 -jar pig-auth.jar > /dev/null 2>&1 &
nohup java -Dfile.encoding=utf-8 -jar pig-upms-biz.jar > /dev/null 2>&1 &
```



### éƒ¨ç½²å‰ç«¯


```shell
mkdir -p /data/pig-ui && cp -r dist/* /data/pig-ui

cd /etc/nginx/conf.d && rm -f default.conf

vim pig.conf

server {
    listen 80;
    server_name localhost;

    gzip on;
    gzip_static on;     # éœ€è¦ http_gzip_static_module æ¨¡å—
    gzip_min_length 1k;
    gzip_comp_level 4;
    gzip_proxied any;
    gzip_types text/plain text/xml text/css;
    gzip_vary on;
    gzip_http_version   1.0; #å…¼å®¹å¤šå±‚ nginx åä»£
    gzip_disable "MSIE [1-6]\.(?!.*SV1)";

    # æ‰“åŒ…å¥½çš„ dist ç›®å½•æ–‡ä»¶ï¼Œæ”¾ç½®åˆ°è¿™ä¸ªç›®å½•ä¸‹
    root /data/pig-ui;
    
    # æ³¨æ„ç»´æŠ¤æ–°å¢å¾®æœåŠ¡ï¼Œgateway è·¯ç”±å‰ç¼€
    location ^~/api/ {
        proxy_pass http://127.0.0.1:9999/; #æ³¨æ„/åç¼€
        proxy_connect_timeout 60s;
        proxy_read_timeout 120s;
        proxy_send_timeout 120s;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto http;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $http_host;
        proxy_set_header from "";
    }
    
    # å±è”½æ‰€æœ‰æ•æ„Ÿè·¯å¾„ï¼Œä¸ç”¨æ”¹ä»£ç 
    location ~* ^/(actuator|swagger-ui|v3/api-docs|swagger-resources|webjars|doc.html) {
        return 403; # ç¦æ­¢è®¿é—®
    }
    
}
```



## ECS å®‰å…¨ç»„


:::color3
**æ³¨æ„é…ç½®å®‰å…¨ç»„ï¼ŒæœåŠ¡ç›¸å…³çš„ç«¯å£å¯¹å¤–æš´éœ²  **

+ 80/443    (ç”Ÿäº§æ¨¡å¼åªéœ€è¦å¼€å¯æ­¤å…³å£)



+ 9999 ç½‘å…³ï¼ˆå¦‚éœ€è®¿é—® swagger éœ€è¦ï¼‰
+ 5001 ç›‘æ§ï¼ˆå¦‚éœ€è®¿é—® monitor éœ€è¦ï¼‰
+ 5020 ç›‘æ§ï¼ˆå¦‚éœ€è®¿é—® monitor éœ€è¦ï¼‰

:::



![](/images/1600526129960-ccee8fcd-1db8-4597-a9ab-411b0ea84f67.png)





## â¤  é—®é¢˜å’¨è¯¢
![](/images/1662563973685-c22e9831-db66-42b5-973f-886d25d1e0e7.gif)

