---
title: "HTTPS 证书配置和使用教程"
---


<Note>
本文档仅提供 HTTPS 前端和 Nginx 部署相关配置。CentOS 部署请参考 [pig4cloud 部署文档](https://wiki.pig4cloud.com/docs/deployment/linux-deploy)
</Note>

<Warning>
必须拥有域名，并且域名已备案并解析到服务器。本教程以阿里云为主，其他云服务商配置方式类似。
</Warning>

## 1. 登录阿里云

访问 [阿里云登录页面](https://account.aliyun.com/login/login.htm)，输入用户名和密码登录。

## 2. 购买 SSL 免费证书

### 2.1 搜索 SSL
在搜索框中输入 "ssl"，点击搜索或回车。

<Note>
如果域名和服务器不在同一运营商，需要在云服务器所在运营商购买和配置 SSL 证书。
</Note>

### 2.2 购买证书
1. 点击"立即购买证书"
2. 选择"选购 SSL 证书"

### 2.3 立即购买
选择商品属性并点击"立即购买"

## 3. SSL 证书申请

### 3.1 进入 SSL 管理控制台
1. 返回首页搜索 "ssl"
2. 选择"管理控制台"

### 3.2 进入免费证书
点击左侧"SSL 证书"，选择右侧的"免费证书"

<Warning>
免费证书只能为一级域名提供 HTTPS 服务，不支持二级域名和三级域名。
</Warning>

### 3.3 填写信息
点击创建证书并填写认证申请信息。

<Note>
申请通过通常需要几分钟时间。
</Note>

#### 推荐方式
1. 点击"申请"
2. 填写基本信息：
   - 域名验证方式：自动 DNS 验证
   - CSR 生成方式：系统生成
3. 点击下一步进入提交审核

#### 不推荐方式
1. 填写基本信息：
   - 域名验证方式：自动 DNS 验证
   - CSR 生成方式：手动填写

<Warning>
手动填写 CSR 的证书不支持部署到阿里云产品。在制作 CSR 文件时请务必保存好私钥文件。私钥和 SSL 证书一一对应，一旦丢失私钥，数字证书将不可使用。
</Warning>

### 3.4 提交审核
完成域名验证，提交审核。

## 4. 证书下载

等待状态变为"已签发"后，点击下载，选择下载 Nginx 证书。

<Note>
下载内容说明：
- 系统生成：包含证书信息和密钥
- 自动填写：仅包含证书信息，密钥需要根据文件自行生成
</Note>

### 4.1 开放安全组
1. 点击"实例"，选择服务器
2. 点击"安全组"，选择"内网入方向全部规则"
3. 检查是否开启 443 端口
4. 如未开启，选择"安全组"列表中的"加入安全组"并"配置规则"

## 5. 拷贝证书文件

在服务器 Nginx 的 conf 目录下创建 cert 目录，并将 SSL 证书（.pem）和私钥（.key）文件拷贝到该目录。

```shell
# 示例：Nginx 安装在 /usr/local 目录下
mkdir /usr/local/nginx/conf/cert -p
```

## 6. Nginx 部署 SSL 模块（可选）

<Note>
通过 tar 包安装 Nginx 需要部署 SSL 模块。
</Note>

### 6.1 检查 SSL 模块
1. 进入 Nginx 安装目录下的 sbin 目录
2. 执行 `./nginx -V` 命令检查是否包含 SSL 模块

### 6.2 安装 SSL 模块
如果未安装 SSL 模块，需要重新编译安装：

```shell
cd /home/software/nginx
./configure \
--prefix=/usr/local/nginx \
--with-http_ssl_module
make
make install
```

## 7. 前端部署

### 7.1 通过 tar 安装 Nginx 方式

```shell
# 进入 Nginx 配置目录
cd /usr/local/nginx/conf/
vi nginx.conf
```

配置示例：

```nginx
user root;
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    server {
        listen 443 ssl;
        server_name www.domain.com domain.com;
        ssl_certificate cert/your_cert.pem;
        ssl_certificate_key cert/your_key.key;
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
        ssl_prefer_server_ciphers on;
        
        root /data/pig-ui;
        index index.html;
        
        location / {
            root /data/pig-ui;
            index index.html;
        }
        
        location ~* ^/(code|auth|admin|gen) {
            proxy_pass http://127.0.0.1:9999;
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-Proto $scheme;
            add_header Cache-Control no-store;
            proxy_connect_timeout 15s;
            proxy_send_timeout 15s;
            proxy_read_timeout 15s;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto http;
        }
    }
    
    server {
        listen 80;
        server_name www.domain.com domain.com;
        return 301 https://$server_name$request_uri;
    }
}
```

### 7.2 通过 yum 安装 Nginx 方式

```shell
mkdir -p /data/pig-ui && cp -r dist/* /data/pig-ui
cd /etc/nginx/conf.d && rm -f default.conf
vim pigx.conf
```

配置内容与 7.1 节相同。

## 8. 验证部署

访问 `https://www.domain.com` 验证部署是否成功。

## 参考文档

- [阿里云 HTTPS 配置教程](https://help.aliyun.com/video_detail/212905.html)
- [华为云免费 SSL 申请](https://support.huaweicloud.com/qs-ccm/ccm_07_0012.html)
- [腾讯云免费 SSL 申请](https://cloud.tencent.com/document/product/400/6814)

## 作者信息

文档作者：[xiaozhang](https://gitee.com/xiaozhang_xiaozhang)

## 问题咨询

<Card title="技术支持" icon="help">
如有问题，请联系技术支持获取帮助。
</Card>

